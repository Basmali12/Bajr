<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<title>Ø¯Ø±Ø¯Ø´Ø© Ù‡Ø§ÙƒØ±ÙŠØ© + Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
  body { font-family: 'Courier New', monospace; background: #000; color: #00ffcc; direction: rtl; margin:0; padding:2vw; display:flex; justify-content:center; }
  .app { width:100%; max-width:720px; }
  .top-row { display:flex; gap:10px; align-items:center; justify-content:space-between; margin-bottom:12px; }
  .user-number { background: rgba(0,255,204,0.06); border:1px solid #00ffcc; padding:6px 10px; border-radius:6px; font-weight:700; }
  /* (Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ù…Ø«Ù„ Ø§Ù„Ù„ÙŠ Ø§ØªÙÙ‚Ù†Ø§ Ø¹Ù„ÙŠÙ‡ Ø³Ø§Ø¨Ù‚Ø§Ù‹) */
  .top-buttons { display:flex; gap:10px; justify-content:center; margin-bottom:10px; }
  .top-buttons button { background:#00ffcc; color:#000; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; display:flex; gap:8px; align-items:center; }
  .audio-btn { width:44px; height:44px; border-radius:50%; background:#00ffcc; display:flex; align-items:center; justify-content:center; cursor:pointer; }
  .chat-box { background: rgba(0,0,0,0.85); border:2px solid #00ffcc; border-radius:8px; padding:16px; box-shadow:0 0 20px #00ffcc; }
  textarea { width:100%; min-height:100px; background:#111; color:#00ffcc; border:1px solid #00ffcc; border-radius:6px; padding:10px; resize:none; }
  button.main { margin-top:10px; padding:10px; background:#00ffcc; color:#000; border:none; border-radius:6px; cursor:pointer; }
  .response { margin-top:12px; background:#111; padding:12px; border-radius:6px; border:1px solid #00ffcc; white-space:pre-wrap; position:relative; }
  .copy-btn { position:absolute; top:8px; left:8px; background:#00ffcc; color:#000; border:none; padding:5px 8px; border-radius:4px; cursor:pointer;}
</style>
</head>
<body>
  <div class="app">
    <div class="top-row">
      <div class="top-buttons">
        <a href="https://t.me/am_an12" target="_blank" rel="noopener noreferrer" style="text-decoration:none;">
          <button><img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="" style="width:20px"> Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</button>
        </a>
        <a href="https://instabio.cc/Techology" style="text-decoration:none;">
          <button> <img src="https://cdn-icons-png.flaticon.com/512/1170/1170678.png" alt="" style="width:20px"> Ù…ØªØ¬Ø±Ù†Ø§</button>
        </a>
      </div>

      <!-- Ø¹Ø±Ø¶ Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù‡Ù†Ø§ -->
      <div class="user-number" id="userNumberDisplay">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    </div>

    <!-- Ø²Ø± Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ -->
    <div style="display:flex; justify-content:center; margin-bottom:10px;">
      <div class="audio-btn" id="toggleBtn">â–¶ï¸</div>
    </div>
    <audio id="myAudio" src="https://b.top4top.io/m_3597hg8gt1.mp3" loop></audio>

    <div class="chat-box">
      <h2>Ø¯Ø±Ø¯Ø´Ø© Ù…Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h2>
      <textarea id="message" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."></textarea>
      <button class="main" id="sendBtn">Ø¥Ø±Ø³Ø§Ù„</button>

      <div class="response" id="responseBox" style="display:none;">
        <button class="copy-btn" onclick="copyResponse()">Ù†Ø³Ø® Ø§Ù„Ø±Ø¯</button>
        <span id="loadingIcon">â³</span>
        <div id="responseText"></div>
      </div>

      <button class="main" onclick="clearChat()">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</button>

      <div style="margin-top:12px;">
        <button class="main" onclick="showMaintenance('image')">ğŸ–¼ï¸ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ØµÙˆØ±Ø©</button>
        <button class="main" onclick="showMaintenance('video')">ğŸ¥ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙÙŠØ¯ÙŠÙˆ</button>
        <button class="main" onclick="showMaintenance('app')">ğŸ“± Ø¥Ù†Ø´Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚</button>
      </div>

      <div class="response" id="maintenanceBox" style="display:none;"></div>
    </div>
  </div>

<script>
/* ======= Ø¥Ø¹Ø¯Ø§Ø¯ JSONBin (ØªÙ…Ù‘ Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù„ÙŠ Ø£Ø¹Ø·ÙŠØªÙÙ‡) ======= */
const BIN_ID = "690d134ed0ea881f40d879c3"; // Ø§Ù„Ù€ "Ø§ÙŠØ¯ÙŠ" Ø§Ù„Ù„ÙŠ Ø£Ø¹Ø·ÙŠØªÙÙ‡
const API_KEY = "$2a$10$qVIQyUG1KUQEQzhi.qDAv.Fk929JlfBbTMoVivG3YRt54oQjP3Qe."; // Ø§Ù„Ù€ Master Key Ø§Ù„Ù„ÙŠ Ø£Ø¹Ø·ÙŠØªÙÙ‡

/* ======= deviceId: Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù€ id Ø§Ù„Ù„ÙŠ Ø£Ø¹Ø·ÙŠØª Ø£Ùˆ Ù‚ÙŠÙ…Ø© ÙØ±ÙŠØ¯Ø© Ø£Ø®Ø±Ù‰ Ø¥Ù† Ø£Ø±Ø¯Øª ======= */
const deviceId = "690d134ed0ea881f40d879c3"; // Ù„Ùˆ ØªØ±ÙŠØ¯ ØªØºÙŠÙ‘Ø±Ù‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ Ø¶Ø¹ Ù…Ù†Ø·Ù‚ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù‡Ù†Ø§

/* Ø¹Ø±Ø¶ Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© */
const userNumberDisplay = document.getElementById('userNumberDisplay');

/* Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰/ØªØ¹ÙŠÙŠÙ† Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø¨Ø± JSONBin */
async function assignGlobalUserNumber(deviceId) {
  try {
    // 1) Ø¬Ù„Ø¨ Ø¢Ø®Ø± Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù€ BIN
    const getRes = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
      headers: { "X-Master-Key": API_KEY }
    });

    if (!getRes.ok) {
      console.error("Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© BIN:", getRes.status, await getRes.text());
      userNumberDisplay.textContent = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©";
      return;
    }

    const getJson = await getRes.json();
    // Ù†ØªÙˆÙ‚Ø¹ Ø¨Ù†ÙŠØ©: { "lastUser": 0, "users": { "deviceId1": 1, ... } }
    const record = getJson.record || {};
    let lastUser = typeof record.lastUser === 'number' ? record.lastUser : 0;
    let users = typeof record.users === 'object' && record.users !== null ? record.users : {};

    // 2) Ø¥Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² Ù…Ø³Ø¬Ù‘Ù„ Ø³Ø§Ø¨Ù‚Ø§Ù‹ØŒ Ù†Ø¹Ø±Ø¶ Ø±Ù‚Ù…Ù‡ ÙˆÙ„Ø§ Ù†Ø²ÙŠØ¯
    if (users[deviceId]) {
      userNumberDisplay.textContent = `Ø£Ù†Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø±Ù‚Ù…: ${users[deviceId]}`;
      return;
    }

    // 3) ØºÙŠØ± Ù…Ø³Ø¬Ù‘Ù„ â†’ Ù†Ø²ÙŠØ¯ lastUser ÙˆÙ†Ø±Ø¨Ø·Ù‡ Ø¨Ø§Ù„Ù€ deviceId
    lastUser++;
    users[deviceId] = lastUser;

    // 4) Ù†Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¹Ø¨Ø± PUT Ø¹Ù„Ù‰ BIN
    const putRes = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
        "X-Master-Key": API_KEY
      },
      body: JSON.stringify({ lastUser, users })
    });

    if (!putRes.ok) {
      console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù„Ù€ BIN:", putRes.status, await putRes.text());
      userNumberDisplay.textContent = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸";
      return;
    }

    userNumberDisplay.textContent = `Ø£Ù†Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø±Ù‚Ù…: ${lastUser}`;
  } catch (err) {
    console.error("Ø®Ø·Ø£ ÙÙŠ assignGlobalUserNumber:", err);
    userNumberDisplay.textContent = "Ø®Ø·Ø£ Ø¨Ø§Ù„Ø§ØªØµØ§Ù„";
  }
}

/* Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
assignGlobalUserNumber(deviceId);

/* ======= Ø¨Ø§Ù‚ÙŠ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ù…ÙˆØ³ÙŠÙ‚Ù‰ + Ø¯Ø±Ø¯Ø´Ø©) ======= */
// ØªØ´ØºÙŠÙ„/Ø§ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰
const audio = document.getElementById('myAudio');
const btnAudio = document.getElementById('toggleBtn');
let isPlaying = false;
audio.volume = 0.7;
btnAudio.addEventListener('click', () => {
  if (!isPlaying) { audio.play().catch(()=>{}); btnAudio.textContent='â¸ï¸'; btnAudio.classList.add('active'); isPlaying=true; }
  else { audio.pause(); btnAudio.textContent='â–¶ï¸'; btnAudio.classList.remove('active'); isPlaying=false; }
});

// Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© (Ù…Ø®ØªØµØ±ØŒ Ù†ÙØ³ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ù„ÙŠ ØªØ³ØªØ®Ø¯Ù…Ù‡)
const sendBtn = document.getElementById("sendBtn");
const responseBox = document.getElementById("responseBox");
const responseText = document.getElementById("responseText");
const maintenanceBox = document.getElementById("maintenanceBox");
const loadingIcon = document.getElementById("loadingIcon");

sendBtn.addEventListener("click", async function () {
  const message = document.getElementById("message").value.trim();
  maintenanceBox.style.display = "none";
  responseBox.style.display = "block";
  responseText.textContent = "";
  loadingIcon.textContent = "â³";

  if (!message) { responseText.textContent = "âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø±Ø³Ø§Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹."; loadingIcon.textContent=""; return; }

  let countdown = 10;
  const timer = setInterval(() => {
    if (countdown > 0) { loadingIcon.textContent = countdown; countdown--; }
    else { loadingIcon.textContent = "â³"; }
  }, 1000);

  // Ø¶Ø¹ apiUrl Ùˆ apiKey Ø­Ù‚ÙŠÙ‚ØªÙƒ Ù‡Ù†Ø§ Ø¥Ø°Ø§ ØªØ±ÙŠØ¯ Ø±Ø¨Ø· Ø§Ù„Ù€ chat API
  const apiUrl = "https://yojagahyhoogwtfpvtok.supabase.co/functions/v1/api-chat";
  const apiKey = "wgpt_274mcgyt1rurpp5cfqh4xc";
  const format = "json";

  try {
    const res = await fetch(`${apiUrl}?message=${encodeURIComponent(message)}&key=${apiKey}&format=${format}`);
    const rawText = await res.text();
    clearInterval(timer);
    loadingIcon.textContent = "";

    let data;
    try { data = JSON.parse(rawText); } catch {
      responseText.textContent = "âš ï¸ Ø§Ù„Ø±Ø¯ ØºÙŠØ± Ù…Ù†Ø³Ù‚ JSON:\n" + rawText; return;
    }

    if (data.success) {
      responseText.textContent = `${data.response}\n\nØ§Ù„Ù‡Ø§ÙƒØ±Ø² Ø¨Ø³Ø§Ù… Ø¹Ù…Ø§Ø±Ø©\nğŸ“ Ø§Ù„Ø¯Ø¹Ù…: @am_an12`;
    } else {
      responseText.textContent = `âŒ Ø®Ø·Ø£: ${data.error}\n\nØ§Ù„Ù‡Ø§ÙƒØ±Ø² Ø¨Ø³Ø§Ù… Ø¹Ù…Ø§Ø±Ø©\nğŸ“ Ø§Ù„Ø¯Ø¹Ù…: @am_an12`;
    }
  } catch (error) {
    clearInterval(timer);
    loadingIcon.textContent = "";
    responseText.textContent = `âš ï¸ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`;
  }
});

// Ù†Ø³Ø® Ø§Ù„Ø±Ø¯ (Ù†Øµ ÙÙ‚Ø·)
window.copyResponse = function () {
  const textToCopy = responseText.innerText.trim();
  navigator.clipboard.writeText(textToCopy).then(()=>{ alert("âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø¯!"); }).catch(()=>{ alert("âš ï¸ ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®"); });
};

window.clearChat = function () {
  responseBox.style.display = "none";
  maintenanceBox.style.display = "none";
  document.getElementById("message").value = "";
};

window.showMaintenance = function (type) {
  let label = "";
  if (type === "image") label = "ğŸ–¼ï¸ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ØµÙˆØ±Ø© Ø¬Ø§Ø±ÙŠ Ø§Ù„ØµÙŠØ§Ù†Ø©...";
  if (type === "video") label = "ğŸ¥ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙÙŠØ¯ÙŠÙˆ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØµÙŠØ§Ù†Ø©...";
  if (type === "app") label = "ğŸ“± Ø¥Ù†Ø´Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØµÙŠØ§Ù†Ø©...";
  maintenanceBox.style.display = "block"; maintenanceBox.textContent = label;
};
</script>
</body>
</html>
